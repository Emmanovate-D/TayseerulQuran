<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Forgot Password - TayseerulQuran</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="Reset your password">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/plugins/icofont.min.css">
    <link rel="stylesheet" href="assets/css/plugins/flaticon.css">
    <link rel="stylesheet" href="assets/css/plugins/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

    <div class="main-wrapper">

        <!-- Header Section Start -->
        <div class="header-section">
            <div class="header-main">
                <div class="container">
                    <div class="header-main-wrapper">
                        <div class="header-logo">
                            <a href="index.html"><img src="assets/images/logo.png" alt="Logo"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Header Section End -->

        <!-- Forgot Password Section Start -->
        <div class="section section-padding">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6 col-md-8">
                        <div class="card">
                            <div class="card-body py-5">
                                <div class="text-center mb-4">
                                    <i class="icofont-lock" style="font-size: 60px; color: #007bff;"></i>
                                </div>
                                
                                <h2 class="text-center mb-4">Forgot Password?</h2>
                                <p class="text-center text-muted mb-4">Enter your email address and we'll send you a link to reset your password.</p>
                                
                                <div id="forgotPasswordMessage" class="alert" style="display: none;"></div>

                                <!-- Request Reset Form -->
                                <form id="requestResetForm">
                                    <div class="mb-3">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="resetEmail" placeholder="Enter your email" required>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg" id="requestResetBtn">
                                            Send Reset Link
                                        </button>
                                        <a href="login.html" class="btn btn-outline-secondary">Back to Login</a>
                                    </div>
                                </form>

                                <!-- Reset Password Form (shown when token is present) -->
                                <form id="resetPasswordForm" style="display: none;">
                                    <div class="mb-3">
                                        <label class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" required minlength="6">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password" required minlength="6">
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg" id="resetPasswordBtn">
                                            Reset Password
                                        </button>
                                        <a href="login.html" class="btn btn-outline-secondary">Back to Login</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Forgot Password Section End -->

        <!-- Footer Start -->
        <div class="section footer-section">
            <div class="footer-copyright">
                <div class="container">
                    <div class="copyright-wrapper">
                        <div class="copyright-text">
                            <p>&copy; 2025 <span>Tayseer ul Qur'an</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->

    </div>

    <!-- JS -->
    <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
    <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
    <script src="assets/js/plugins.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/api.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        // If token is present, show reset password form
        if (token) {
            document.getElementById('requestResetForm').style.display = 'none';
            document.getElementById('resetPasswordForm').style.display = 'block';
            document.querySelector('h2').textContent = 'Reset Password';
        }

        // Show message
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('forgotPasswordMessage');
            messageDiv.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'}`;
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Request password reset
        document.getElementById('requestResetForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('resetEmail').value.trim();
            const btn = document.getElementById('requestResetBtn');
            const originalText = btn.textContent;
            
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                // This endpoint would need to be created in the backend
                const response = await fetch(`${API.config.BASE_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(`Password reset link has been sent to ${email}. Please check your inbox.`, 'success');
                    document.getElementById('requestResetForm').reset();
                } else {
                    throw new Error(data.message || 'Failed to send reset link');
                }
            } catch (error) {
                console.error('Reset request error:', error);
                showMessage(error.message || 'An error occurred. Please try again.', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });

        // Reset password
        document.getElementById('resetPasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const resetToken = token;

            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match.', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showMessage('Password must be at least 6 characters long.', 'error');
                return;
            }

            const btn = document.getElementById('resetPasswordBtn');
            const originalText = btn.textContent;
            
            btn.disabled = true;
            btn.textContent = 'Resetting...';

            try {
                // This endpoint would need to be created in the backend
                const response = await fetch(`${API.config.BASE_URL}/auth/reset-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        token: resetToken,
                        newPassword 
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Password has been reset successfully. Redirecting to login...', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    throw new Error(data.message || 'Failed to reset password');
                }
            } catch (error) {
                console.error('Reset password error:', error);
                showMessage(error.message || 'An error occurred. Please try again.', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });
    </script>

</body>

</html>

